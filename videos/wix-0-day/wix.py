#!/usr/bin/env python
# exfiltrate blog data from wix sites
# created by cosmo

# imports
import os
import urllib.request
import xml.etree.ElementTree as ET

# variables to change
print('[!] URL Format : https://example.com/blog')
input_url = input('[~] Enter Wix Blog URL : ')
url = input_url + '/blog-feed.xml'
file_name = input_url[8:-9]
output_xml = f'{file_name}.xml'

# output directories
xml_directory = 'xml'
article_directory = 'articles'
path_to_xml = f'{xml_directory}/{output_xml}'
path_to_articles = f'{article_directory}/{file_name}'
os.system(f'mkdir {xml_directory} {article_directory} {path_to_articles}')

# retrieve data
u = urllib.request.urlopen(url)
data = u.read()

# # write to xml
with open(f'{path_to_xml}', 'wb') as f:
    f.write(data)

# parse data
tree = ET.parse(path_to_xml)
root = tree.getroot()

# wix default namespaces
dc_namespace = 'http://purl.org/dc/elements/1.1/'
content_namespace = 'http://purl.org/rss/1.0/modules/content/'

# iterate through each article
for article in root.findall('.//item'):

    # get values
    title = article.find('title').text
    description = article.find('description').text
    link = article.find('link').text
    guid = article.find('guid').text
    published = article.find('pubDate').text
    thumbnail = article.find('enclosure')
    creator = article.find('{' + dc_namespace + '}creator').text
    content = article.find('{' + content_namespace + '}encoded').text

    # write content to html, view in browser
    print(f'[*] Writing "{title}" to html')
    with open(f'{path_to_articles}/{title}.html', 'w') as f:
        f.write(content)

    # display values
    # print(title)
    # print(description)
    # print(link)
    # print(guid)
    # print(published)
    # print(thumbnail)
    # print(creator)
    # print(content)

# notify user of ouput
print(f'\n[+] XML saved to {path_to_xml}')
print(f'[+] Articles saved to {path_to_articles}/*.html')